<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ­é—¨æ¿å—æ‰«æ - æ™ºè°±AIè‚¡ç¥¨åˆ†æç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            color: #667eea;
            font-size: 1.8em;
            margin: 0 0 10px 0;
        }

        .header-left p {
            color: #666;
            margin: 0;
            font-size: 0.95em;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .section-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sectors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .sector-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .sector-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .sector-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .sector-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .sector-label {
            color: #666;
            font-size: 0.9em;
        }

        .sector-value {
            font-weight: 600;
            color: #333;
        }

        .sector-change-up {
            color: #e74c3c;
        }

        .sector-change-down {
            color: #27ae60;
        }

        .filtered-count {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
            text-align: center;
        }

        .filtered-count-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
        }

        .loading-overlay {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        /* æ¿å—è¯¦æƒ…é¡µæ ·å¼ */
        .stocks-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .stocks-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stocks-table th {
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }

        .stocks-table tbody tr {
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .stocks-table tbody tr:hover {
            background: #f8f9fa;
        }

        .stocks-table td {
            padding: 12px;
            font-size: 0.9em;
        }

        .stock-code {
            font-weight: 600;
            color: #667eea;
        }

        .pattern-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .pattern-å¼€ç›˜è·³æ°´ {
            background: #fee;
            color: #c0392b;
        }

        .pattern-å†²æ¿å›è½ {
            background: #e3f2fd;
            color: #1976d2;
        }

        .pattern-ç ´ä½ä¸‹è·Œ {
            background: #fff3e0;
            color: #e65100;
        }

        .change-up {
            color: #e74c3c;
            font-weight: 600;
        }

        .change-down {
            color: #27ae60;
            font-weight: 600;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
            padding: 20px;
        }

        .pagination button {
            padding: 10px 20px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .page-info {
            color: #666;
            font-size: 0.9em;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            color: #764ba2;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: #333;
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .detail-title {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 8px;
        }

        .detail-label {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #333;
            font-size: 1.1em;
            font-weight: 600;
        }

        .ai-analysis-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #9c27b0;
            margin-top: 15px;
        }

        .suggestion-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div class="header-left">
                <h1>ğŸ” çƒ­é—¨æ¿å—æ‰«æ</h1>
                <p>å±•ç¤ºå‰10çƒ­é—¨æ¿å—ï¼Œç‚¹å‡»æŸ¥çœ‹ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨</p>
            </div>
            <div class="header-controls">
                <a href="/" class="btn btn-secondary">ğŸ  è¿”å›ä¸»é¡µ</a>
                <button class="btn btn-primary" id="scanBtn" onclick="scanSectors()">
                    <span class="spinner" style="display: none;"></span>
                    ğŸ”„ åˆ·æ–°æ¿å—
                </button>
            </div>
        </div>

        <!-- æ¿å—åˆ—è¡¨ -->
        <div class="main-content" id="sectorsView">
            <div class="section-title">
                ğŸ“Š çƒ­é—¨æ¿å—åˆ—è¡¨
                <small style="color: #999; font-weight: normal; margin-left: 10px;">
                    (æŒ‰çƒ­åº¦æ’åº - æˆäº¤é¢è¶Šé«˜è¶Šçƒ­)
                </small>
            </div>

            <div id="sectorsGrid" class="sectors-grid">
                <!-- æ¿å—å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <div id="loadingState" class="loading-overlay" style="display: none;">
                <div class="spinner"></div>
                <p style="color: #666; margin-top: 15px;">æ­£åœ¨æ‰«æçƒ­é—¨æ¿å—...</p>
            </div>

            <div id="emptyState" class="empty-state">
                <p>ğŸ‘† ç‚¹å‡»"åˆ·æ–°æ¿å—"æŒ‰é’®å¼€å§‹æ‰«æ</p>
            </div>
        </div>

        <!-- æ¿å—è¯¦æƒ…è§†å›¾ -->
        <div class="main-content" id="sectorDetailView" style="display: none;">
            <a href="#" class="back-link" onclick="showSectorsView()">
                â† è¿”å›æ¿å—åˆ—è¡¨
            </a>

            <div class="section-title" id="sectorDetailTitle">
                <!-- åŠ¨æ€å¡«å…… -->
            </div>

            <div class="table-container">
                <table class="stocks-table">
                    <thead>
                        <tr>
                            <th>ä»£ç </th>
                            <th>åç§°</th>
                            <th>ç°ä»·</th>
                            <th>æ¶¨è·Œå¹…</th>
                            <th>å›¾å½¢</th>
                            <th>ç½®ä¿¡åº¦</th>
                        </tr>
                    </thead>
                    <tbody id="stocksTableBody">
                        <!-- è‚¡ç¥¨æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="pagination">
                <!-- åˆ†é¡µæ§ä»¶å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- è¯¦æƒ…å¼¹çª— -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="modalBody">
                <!-- è¯¦æƒ…å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        let currentSectors = [];
        let currentStocks = [];
        let currentSectorStocks = [];  // å½“å‰æ¿å—çš„è‚¡ç¥¨åˆ—è¡¨
        let currentPage = 1;
        let pageSize = 20;

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰«æ
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(scanSectors, 500);
        });

        // æ‰«ææ¿å—
        async function scanSectors() {
            const scanBtn = document.getElementById('scanBtn');
            const loadingState = document.getElementById('loadingState');
            const emptyState = document.getElementById('emptyState');
            const sectorsGrid = document.getElementById('sectorsGrid');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            scanBtn.classList.add('loading');
            scanBtn.querySelector('.spinner').style.display = 'inline-block';
            loadingState.style.display = 'block';
            emptyState.style.display = 'none';
            sectorsGrid.innerHTML = '';

            try {
                const response = await fetch('/api/sector-scan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        sector_count: 10,
                        stocks_per_sector: 10
                    })
                });

                const result = await response.json();

                if (result.success) {
                    currentSectors = result.sectors;
                    currentStocks = result.all_stocks;
                    displaySectors(result);
                } else {
                    alert('æ‰«æå¤±è´¥: ' + result.error);
                }
            } catch (error) {
                alert('æ‰«æå¤±è´¥: ' + error);
            } finally {
                // éšè—åŠ è½½çŠ¶æ€
                scanBtn.classList.remove('loading');
                scanBtn.querySelector('.spinner').style.display = 'none';
                loadingState.style.display = 'none';
            }
        }

        // æ˜¾ç¤ºæ¿å—åˆ—è¡¨
        function displaySectors(result) {
            const sectorsGrid = document.getElementById('sectorsGrid');

            // ç»Ÿè®¡æ¯ä¸ªæ¿å—ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨æ•°
            const sectorStockCounts = {};
            result.filtered_stocks.forEach(stock => {
                const sectorName = stock.sector_name;
                sectorStockCounts[sectorName] = (sectorStockCounts[sectorName] || 0) + 1;
            });

            sectorsGrid.innerHTML = result.sectors.map((sector, index) => {
                const filteredCount = sectorStockCounts[sector.sector_name] || 0;
                const changeClass = sector.change_percent >= 0 ? 'sector-change-up' : 'sector-change-down';

                // æˆäº¤é¢è½¬æ¢ä¸ºä¸‡å…ƒæˆ–äº¿å…ƒ
                let amountDisplay = '';
                if (sector.amount) {
                    const amountWan = sector.amount / 10000;
                    if (amountWan >= 10000) {
                        amountDisplay = `${(amountWan / 10000).toFixed(1)}äº¿å…ƒ`;
                    } else {
                        amountDisplay = `${amountWan.toFixed(0)}ä¸‡å…ƒ`;
                    }
                }

                return `
                    <div class="sector-card" onclick="viewSectorDetail('${sector.sector_name}', '${sector.sector_code}')">
                        <div class="sector-name">${sector.sector_name}</div>
                        <div class="sector-info">
                            <span class="sector-label">çƒ­åº¦(æˆäº¤é¢):</span>
                            <span class="sector-value" style="color: #FF9800;">ğŸ”¥ ${amountDisplay}</span>
                        </div>
                        <div class="sector-info">
                            <span class="sector-label">æ¿å—æ¶¨è·Œ:</span>
                            <span class="sector-value ${changeClass}">${sector.change_percent >= 0 ? '+' : ''}${sector.change_percent}%</span>
                        </div>
                        <div class="filtered-count">
                            <span class="sector-label">ç¬¦åˆæ¡ä»¶:</span>
                            <span class="filtered-count-badge">${filteredCount} åªè‚¡ç¥¨</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æŸ¥çœ‹æ¿å—è¯¦æƒ…
        async function viewSectorDetail(sectorName, sectorCode) {
            const sectorsView = document.getElementById('sectorsView');
            const sectorDetailView = document.getElementById('sectorDetailView');
            const stocksTableBody = document.getElementById('stocksTableBody');
            const pagination = document.getElementById('pagination');

            // åˆ‡æ¢è§†å›¾
            sectorsView.style.display = 'none';
            sectorDetailView.style.display = 'block';

            // æ›´æ–°æ ‡é¢˜
            document.getElementById('sectorDetailTitle').innerHTML = `
                ğŸ“Š ${sectorName} - ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨
                <small style="color: #999; font-weight: normal; margin-left: 10px;">
                    (å¼€ç›˜è·³æ°´ / å†²æ¿å›è½ / ç ´ä½ä¸‹è·Œ)
                </small>
            `;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            stocksTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;"><div class="spinner"></div><p style="margin-top: 10px;">æ­£åœ¨åŠ è½½...</p></td></tr>';

            try {
                // ä»ä¹‹å‰çš„æ‰«æç»“æœä¸­ç­›é€‰
                const sectorStocks = currentStocks.filter(s => s.sector_name === sectorName &&
                    ['å¼€ç›˜è·³æ°´', 'å†²æ¿å›è½', 'ç ´ä½ä¸‹è·Œ'].includes(s.pattern_type));

                if (sectorStocks.length === 0) {
                    stocksTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">è¯¥æ¿å—æš‚æ— ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨</td></tr>';
                    pagination.innerHTML = '';
                    currentSectorStocks = [];
                    return;
                }

                // ä¿å­˜å½“å‰æ¿å—çš„è‚¡ç¥¨ï¼Œä¸è¦†ç›–å…¨å±€çš„currentStocks
                currentSectorStocks = sectorStocks;
                currentPage = 1;

                displayStocksPage();

            } catch (error) {
                stocksTableBody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #e74c3c;">åŠ è½½å¤±è´¥: ${error}</td></tr>`;
            }
        }

        // æ˜¾ç¤ºè‚¡ç¥¨åˆ†é¡µ
        function displayStocksPage() {
            const stocksTableBody = document.getElementById('stocksTableBody');
            const pagination = document.getElementById('pagination');

            // ä½¿ç”¨å½“å‰æ¿å—çš„è‚¡ç¥¨åˆ—è¡¨
            const stocks = currentSectorStocks;

            // è®¡ç®—åˆ†é¡µ
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageStocks = stocks.slice(startIndex, endIndex);
            const totalPages = Math.ceil(stocks.length / pageSize);

            // å¡«å……è¡¨æ ¼
            stocksTableBody.innerHTML = pageStocks.map(stock => `
                <tr onclick="showDetail('${stock.stock_code}')">
                    <td class="stock-code">${stock.stock_code}</td>
                    <td>${stock.stock_name}</td>
                    <td>Â¥${stock.current_price}</td>
                    <td class="${stock.change_percent >= 0 ? 'change-up' : 'change-down'}">
                        ${stock.change_percent >= 0 ? '+' : ''}${stock.change_percent}%
                    </td>
                    <td><span class="pattern-badge pattern-${stock.pattern_type}">${stock.pattern_type}</span></td>
                    <td>${stock.pattern_confidence}%</td>
                </tr>
            `).join('');

            // ç”Ÿæˆåˆ†é¡µæ§ä»¶
            let paginationHtml = '';

            if (totalPages > 1) {
                paginationHtml += `
                    <button onclick="changePage('prev')" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>
                    <span class="page-info">ç¬¬ ${currentPage} é¡µ / å…± ${totalPages} é¡µ</span>
                    <button onclick="changePage('next')" ${currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>
                `;
            }

            pagination.innerHTML = paginationHtml;
        }

        // åˆ‡æ¢é¡µé¢
        function changePage(direction) {
            const totalPages = Math.ceil(currentSectorStocks.length / pageSize);

            if (direction === 'prev' && currentPage > 1) {
                currentPage--;
            } else if (direction === 'next' && currentPage < totalPages) {
                currentPage++;
            }

            displayStocksPage();
        }

        // è¿”å›æ¿å—åˆ—è¡¨è§†å›¾
        function showSectorsView() {
            document.getElementById('sectorsView').style.display = 'block';
            document.getElementById('sectorDetailView').style.display = 'none';
            currentPage = 1;
            currentSectorStocks = [];  // æ¸…ç©ºå½“å‰æ¿å—è‚¡ç¥¨
        }

        // æ˜¾ç¤ºè‚¡ç¥¨è¯¦æƒ…
        async function showDetail(stockCode) {
            const modal = document.getElementById('detailModal');
            const modalBody = document.getElementById('modalBody');

            modal.classList.add('active');
            modalBody.innerHTML = '<div class="loading-overlay"><div class="spinner"></div><p>æ­£åœ¨åŠ è½½è¯¦æƒ…...</p></div>';

            try {
                const response = await fetch(`/api/stock-detail/${stockCode}`);
                const result = await response.json();

                if (result.success) {
                    displayDetail(result.detail);
                } else {
                    modalBody.innerHTML = `<p style="color: #e74c3c; padding: 20px;">åŠ è½½å¤±è´¥: ${result.error}</p>`;
                }
            } catch (error) {
                modalBody.innerHTML = `<p style="color: #e74c3c; padding: 20px;">åŠ è½½å¤±è´¥: ${error}</p>`;
            }
        }

        // æ˜¾ç¤ºè¯¦æƒ…å†…å®¹
        function displayDetail(detail) {
            const modalBody = document.getElementById('modalBody');

            let html = `
                <h2 style="color: #667eea; margin-bottom: 20px;">
                    ${detail.stock_name} (${detail.stock_code})
                </h2>

                <div class="detail-section">
                    <div class="detail-title">ğŸ“Š åŸºæœ¬ä¿¡æ¯</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">å½“å‰ä»·æ ¼</div>
                            <div class="detail-value">Â¥${detail.current_price}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æ¶¨è·Œå¹…</div>
                            <div class="detail-value ${detail.change_percent >= 0 ? 'change-up' : 'change-down'}">
                                ${detail.change_percent >= 0 ? '+' : ''}${detail.change_percent}%
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å¼€ç›˜ä»·</div>
                            <div class="detail-value">Â¥${detail.open_price}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æœ€é«˜ä»·</div>
                            <div class="detail-value">Â¥${detail.high_price}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æœ€ä½ä»·</div>
                            <div class="detail-value">Â¥${detail.low_price}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æ˜¨æ”¶ä»·</div>
                            <div class="detail-value">Â¥${detail.prev_close}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æ¶¨åœä»·</div>
                            <div class="detail-value">Â¥${detail.limit_up}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æˆäº¤é‡</div>
                            <div class="detail-value">${(detail.volume / 10000).toFixed(0)} ä¸‡æ‰‹</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-title">ğŸ” å›¾å½¢è¯†åˆ«</div>
                    <div style="background: #f8f9fa; padding: 15px 20px; border-radius: 8px;">
                        <p style="margin-bottom: 8px;"><strong>å›¾å½¢ç±»å‹:</strong>
                            <span class="pattern-badge pattern-${detail.pattern_type}" style="margin-left: 10px;">${detail.pattern_type}</span>
                        </p>
                        <p style="margin-bottom: 0;"><strong>ç½®ä¿¡åº¦:</strong> ${detail.pattern_confidence}%</p>
                        <p style="margin-bottom: 0; margin-top: 8px; color: #666;"><strong>åŸå› :</strong> ${detail.pattern_reason}</p>
                    </div>
                </div>
            `;

            if (detail.ai_analysis) {
                html += `
                    <div class="detail-section">
                        <div class="detail-title">ğŸ¤– AIåˆ†æ</div>
                        <div class="ai-analysis-box">
                            ${detail.ai_analysis.replace(/\n/g, '<br>')}
                        </div>
                    </div>
                `;
            }

            if (detail.operation_suggestion) {
                const sug = detail.operation_suggestion;
                let priceLevelsHtml = '';
                if (sug.price_levels && Object.keys(sug.price_levels).length > 0) {
                    priceLevelsHtml = '<div style="margin-top: 10px;"><strong>ğŸ“ å…³é”®ä»·ä½:</strong><ul style="margin: 8px 0; padding-left: 20px;">';
                    for (const [key, value] of Object.entries(sug.price_levels)) {
                        priceLevelsHtml += `<li>${key}: ${value} å…ƒ</li>`;
                    }
                    priceLevelsHtml += '</ul></div>';
                }

                html += `
                    <div class="detail-section">
                        <div class="detail-title">ğŸ“Š æ“ä½œå»ºè®®</div>
                        <div class="suggestion-box">
                            <p style="margin-bottom: 10px;"><strong>æ“ä½œ:</strong> ${sug.action}
                                <span style="margin-left: 10px; padding: 3px 10px; background: ${sug.confidence === 'é«˜' ? '#4caf50' : sug.confidence === 'ä¸­' ? '#ff9800' : '#9e9e9e'}; color: white; border-radius: 12px; font-size: 0.85em;">ç½®ä¿¡åº¦: ${sug.confidence}</span>
                            </p>
                            <p style="margin-bottom: 10px;"><strong>ç†ç”±:</strong><br>${sug.reasoning}</p>
                            ${priceLevelsHtml}
                            <p style="margin: 0; color: #d32f2f;"><strong>âš ï¸ é£é™©æç¤º:</strong> ${sug.risk_warning}</p>
                        </div>
                    </div>
                `;
            }

            html += `
                <div style="text-align: right; margin-top: 20px; color: #999; font-size: 0.85em;">
                    æ›´æ–°æ—¶é—´: ${detail.update_time}
                </div>
            `;

            modalBody.innerHTML = html;
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
