# 📊 智谱AI股票分析系统 - 使用说明

## 🎯 系统简介

这是一个基于智谱AI的智能股票分析系统，能够实时获取股票行情数据，自动识别图形形态，并使用AI进行专业分析。

### 核心特性

- ✅ **真实数据**：从腾讯财经API获取实时行情，每次分析都是最新数据
- ✅ **智能识别**：自动检测开盘跳水、冲板回落、破位下跌等图形形态
- ✅ **AI分析**：使用智谱GLM-4-Plus模型进行专业分析
- ✅ **风险控制**：自动过滤不适合分析的市场状态（如强势上涨、震荡整理）
- ✅ **批量分析**：支持同时分析多只股票

---

## 🚀 快速开始

### 1. 环境配置

确保已安装Python 3.7+和必要的依赖：

```bash
# 安装依赖
pip install python-dotenv zhipuai requests
```

### 2. 配置API密钥

在项目根目录创建 `.env` 文件：

```bash
# 智谱AI配置
ZHIPU_API_KEY=你的API密钥
ZHIPU_MODEL=glm-4-plus

# 默认AIGC模型（可选）
DEFAULT_AIGC_MODEL=zhipu
```

**获取智谱AI密钥**：访问 https://open.bigmodel.cn/usercenter/apikeys

### 3. 开始分析

```bash
# 分析单只股票（自动检测图形类型）
python3 analyze.py 601138

# 分析单只股票（指定图形类型）
python3 analyze.py 601138 -p 开盘跳水

# 批量分析
python3 real_time_analysis.py
```

---

## 📖 详细使用方法

### 方式1：快速分析（推荐）

#### 基础用法

```bash
python3 analyze.py <股票代码>
```

**示例**：

```bash
# 分析工业富联
python3 analyze.py 601138

# 分析贵州茅台
python3 analyze.py 600519

# 分析比亚迪
python3 analyze.py 002594
```

#### 高级选项

```bash
# 指定图形类型
python3 analyze.py 601138 -p 开盘跳水
python3 analyze.py 601138 -p 破位下跌
python3 analyze.py 601138 -p 冲板回落

# 自动检测模式（默认）
python3 analyze.py 601138 -p auto

# 禁用自动检测，强制使用指定类型
python3 analyze.py 601138 -p 开盘跳水 --no-auto-detect
```

#### 输出示例

```
======================================================================
📊 分析 601138
======================================================================
股票名称: 工业富联
开盘价: 57.0 元
实时价: 57.7 元
最高价: 58.0 元
涨跌: +1.23%
======================================================================

🔍 图形检测: 开盘跳水 (置信度: 90%)
   原因: 开盘后下跌2.37%
======================================================================

🤖 智谱AI分析结果 (开盘跳水):
======================================================================
真跳水，风险中。短线规避。支撑1370，压力1400。
======================================================================
```

---

### 方式2：交互式分析

#### 启动交互式工具

```bash
python3 real_time_analysis.py
```

#### 功能菜单

1. **单只股票分析**
   - 输入股票代码
   - 系统自动检测图形类型
   - 获取AI分析结果

2. **批量股票分析**
   - 输入多只股票代码（用空格分隔）
   - 系统依次分析每只股票
   - 自动添加延迟避免API限流

#### 使用示例

```
请选择分析模式:
1. 单只股票分析
2. 批量股票分析

请选择 [1-2]: 2

请输入股票代码列表（用空格或逗号分隔）
示例: 601138 600036 000001

股票代码: 601138 600519 002594
```

---

## 🔍 图形类型说明

### 支持的图形类型

| 图形类型 | 识别标准 | 适用场景 |
|---------|---------|---------|
| **开盘跳水** | 开盘后下跌超过2% | 开盘快速下跌，判断是真跳水还是假跳水 |
| **冲板回落** | 冝高超8%后回落超3% | 冲至涨停板后回落，分析是否需要出货 |
| **破位下跌** | 跌破关键支撑位 | 跌破均线或平台支撑，判断风险等级 |

### 自动检测规则

系统会自动检测以下市场状态：

| 市场状态 | 检测条件 | 处理方式 |
|---------|---------|---------|
| **强势上涨** | 涨幅≥5%或接近涨停 | 不使用图形分析，提供操作建议 |
| **震荡整理** | 涨跌幅在±2%以内 | 不使用图形分析，建议观望 |
| **开盘跳水** | 开盘后跌超2% | ✅ 使用开盘跳水模板分析 |
| **冲板回落** | 冲高超8%且回落超3% | ✅ 使用冲板回落模板分析 |
| **其他** | 常规波动 | 根据具体情况判断 |

---

## 📊 系统预设股票

系统已预置25只热门股票的真实数据，涵盖以下板块：

### 银行板块
- 600000 浦发银行
- 000001 平安银行
- 600036 招商银行
- 601398 工商银行
- 601939 建设银行

### 科技板块
- 601138 工业富联
- 688981 中芯国际
- 002475 立讯精密
- 688256 寒武纪

### 通信板块
- 601869 长飞光纤
- 300502 新易盛
- 300308 中际旭创
- 300394 天孚通信

### 白酒板块
- 600519 贵州茅台
- 000858 五粮液

### 新能源板块
- 300750 宁德时代
- 002594 比亚迪
- 601012 隆基绿能

### 其他板块
- 603993 洛阳钼业（有色）
- 601005 重庆钢铁（钢铁）
- 000333 美的集团（家电）
- 600276 恒瑞医药（医药）

### 查看所有预设股票

```bash
python3 list_stocks.py
```

---

## 💡 实用场景

### 场景1：盘中快速分析

```bash
# 开盘后快速检查持仓股票
python3 analyze.py 600519
python3 analyze.py 601138
python3 analyze.py 002594
```

### 场景2：选股后批量分析

```bash
# 启动批量分析
python3 real_time_analysis.py

# 选择模式2，输入候选股票代码
601138 600036 000001 600519
```

### 场景3：监控特定图形

```bash
# 检查多只股票是否有开盘跳水
for code in 601138 600036 000001; do
    python3 analyze.py $code -p 开盘跳水
done
```

---

## ⚠️ 注意事项

### 1. 数据时效性

- **交易时间**：真实API在交易时间返回的数据最准确
- **数据延迟**：免费API可能有几秒到十几秒的延迟
- **非交易时间**：可能返回前一交易日的收盘数据

### 2. API限制

- **智谱AI**：有调用频率限制，批量分析时自动添加3秒延迟
- **腾讯财经**：建议避免短时间内频繁查询同一只股票

### 3. 分析准确性

- **图形识别**：系统基于价格波动自动识别，仅供参考
- **AI分析**：基于历史数据和图形模式，不构成投资建议
- **风险提示**：股市有风险，投资需谨慎

---

## 🔧 常见问题

### Q1: 为什么有些股票无法分析？

**A**: 系统会自动检测市场状态，如果股票处于以下状态，不会使用图形分析模板：
- 强势上涨（涨超5%或接近涨停）
- 震荡整理（涨跌幅在±2%以内）

这些状态不适合使用开盘跳水/破位下跌/冲板回落等图形模板。

### Q2: 如何获取更多股票的数据？

**A**: 有三种方式：

1. **实时获取**：直接使用股票代码，系统会从腾讯财经API获取最新数据
2. **添加预设**：编辑 `src/monitors/data_collector.py` 添加Mock数据
3. **查询列表**：运行 `python3 list_stocks.py` 查看所有预设股票

### Q3: 分析结果不准确怎么办？

**A**: 可能的原因和解决方法：

1. **非交易时间**：等待交易时间再分析
2. **数据延迟**：API有延迟，稍后再试
3. **图形误判**：使用 `-p` 参数手动指定正确的图形类型
4. **特殊情况**：市场可能有突发消息，参考其他信息源

### Q4: 如何禁用自动检测？

**A**: 使用 `--no-auto-detect` 参数：

```bash
python3 analyze.py 601138 -p 开盘跳水 --no-auto-detect
```

### Q5: 批量分析时如何控制速度？

**A**: 编辑 `real_time_analysis.py`，修改延迟时间：

```python
# 第241行左右
await asyncio.sleep(3)  # 修改这里的数字（秒）
```

---

## 📚 进阶使用

### 自定义分析参数

编辑 `analyze.py` 或 `real_time_analysis.py`，修改以下参数：

```python
# 交易风格
trading_style="短线"  # 可选：短线、波段、长线

# 模板类型
template_type=TemplateType.SIMPLIFIED  # 简化版（50字）
# template_type=TemplateType.FULL  # 完整版（150字）

# 均线计算
"5日均线": round(current_price * 0.995, 2)
"20日均线": round(current_price * 0.98, 2)
```

### 集成到自己的系统

```python
from analyze import quick_analyze

# 在你的代码中调用
result = await quick_analyze("601138")
print(result)
```

---

## 📞 技术支持

### 相关文件

- `analyze.py` - 快速分析脚本
- `real_time_analysis.py` - 交互式分析工具
- `list_stocks.py` - 股票列表查询工具
- `src/monitors/tencent_collector.py` - 腾讯财经数据采集器
- `src/aigc/model_adapter.py` - 智谱AI适配器
- `src/templates/prompt_templates.py` - 提示词模板

### 文档

- `REALTIME_ANALYSIS_GUIDE.md` - 实时分析详细指南
- `REAL_DATA_GUIDE.md` - 真实数据使用指南
- `README.md` - 项目说明

---

## 🎓 最佳实践

1. **盘中使用**：在交易时间使用，获取最新数据
2. **组合分析**：结合多种图形类型综合判断
3. **风险控制**：不要单次依据AI分析做出重大决策
4. **持续跟踪**：定期分析同一只股票，跟踪变化
5. **人工复核**：AI分析仅供参考，需结合其他信息

---

## ⚡ 快捷命令

```bash
# 快速分析单只股票
python3 analyze.py <股票代码>

# 查看所有预设股票
python3 list_stocks.py

# 启动交互式分析
python3 real_time_analysis.py

# 查看帮助
python3 analyze.py --help
```

---

**免责声明**：本系统仅提供技术分析辅助，不构成任何投资建议。股市有风险，投资需谨慎。
